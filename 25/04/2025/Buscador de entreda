import os
import re
from collections import Counter
import urllib.request

def captureDataFromURL(url):
    try:
        response = urllib.request.urlopen(url)
        content = response.read().decode('utf-8', errors='ignore')  # Read and decode the content
        # Expresión regular para capturar la información del User-Agent
        regex_navegador = r'"Mozilla\/.*?\(.*?;.*?;\s(.*?)\).*?"'
        navegadores = re.findall(regex_navegador, content)
        return navegadores
    except Exception as e:
        print(f"Error al leer el archivo desde la URL: {e}")
        return None

def procesarNavegadores(datos_navegadores, nombre_archivo="URL"):
    if datos_navegadores:
        contador_navegadores = Counter(datos_navegadores)
        print(f"\nConteo de navegadores encontrados en el archivo: {nombre_archivo}")
        for navegador, count in contador_navegadores.items():
            print(f"- {navegador}: {count}")
    else:
        print(f"\nNo se encontraron navegadores o hubo un error al leer el archivo: {nombre_archivo}")

if __name__ == "__main__":
    log_url = "https://raw.githubusercontent.com/logpai/loghub/master/Apache/Apache_2k.log"

    print(f"Procesando el archivo desde la URL: {log_url}")
    navegadores = captureDataFromURL(log_url)
    procesarNavegadores(navegadores)
